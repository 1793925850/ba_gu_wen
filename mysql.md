# 一、MySQL 基础

## 1、主键

用来作**唯一标识**的字段

## 2、主键、外键、索引的区别

**定义**：

主键：唯一标识一条记录，不允许重复，不允许为空

外键：外键表示另一张表的主键，允许重复，可以是空值

索引：没有重复值，但可以有一个空值

**作用**：

主键：用来保存数据的完整性

外键：主要用于和其他表建立联系

索引：为了提高查询排序的速度

## 3、表的优化

**在建表之初就要考虑拆分逻辑**



**字段优化**：

1. 尽量使⽤ TINYINT，SMALLINT，MEDIUM_INT 替代 INT 类型，如果是非负则加上 UNSIGNED
2. VARCHAR 的长度只分配真正需要的空间
3. 尽量使⽤整数或者枚举替代字符串类型
4. 时间类型尽量使⽤ TIMESTAMP 而非 DATETIME
5. 单表不要放太多字段
6. 尽量少使用 NULL，很难查询优化而且占用额外索引空间

## 4、慢查询

**基础**：

1. 设置超时时间，超过这个时间的 sql 语句被称为慢查询
2. long_query_time：默认10秒

**优化**：

1. 运行语句，找到慢查询的 sql
2. 查询区分度最高的字段
3. explain：显⽰ mysql 如何使⽤索引来处理 select 语句以及连接表，可以帮助选择更好的索引、写出更优化的查询语句
4. order by limit 形式的 sql 语句，让排序的表优先查
5. 考虑建立索引
6. 了解业务使用场景

## 5、MySQL 与 MongoDB 的区别

**数据库模型**：

MySQL：关系型

MongoDB：非关系型

**存储方式**：

MySQL：不同引擎有不同的存储方式

MongoDB：虚拟内容+持久化

**查询语句**：

MySQL：sql 语句

MongoDB：使用 MongoDB 自己的查询语句，如 use、show、find、count、sort、insert、update、save、remove、limit

**常见架构特点**：

MySQL：单点、Master-Slave、MHA、Cluster

MongoDB：通过副本集与分片来实现高可用

**数据处理方式**：

MySQL：不同引擎有不同处理特点

MongoDB：基于内存，将热数据存储在物理内存中，从而达到高速读写的目的

**海量数据的存储**：

MySQL效率相对较低，但是 MongoDB 不支持事务

## 6、MySQL 表连接

### 6.1、内/外连接

**内连接**：

驱动表中的记录在被驱动表中找不到匹配的记录，那么驱动表的这条记录**不会加⼊到最后的结果中**

**外连接**：

驱动表中的记录在被驱动表中找不到匹配的记录，也**仍需要加⼊到最后结果中**

**注意**：

对于内连接，驱动表和被驱动表的顺序可以更换；对于外连接，这个顺序不能随意更换

### 6.2、过滤条件

**where**：

不论内外连接，只要是不符合 where 子句的记录都**不会**加⼊到最后的结果中

**on**：

在内连接中与 where 等价；

在外连接中，如果驱动表中的记录在被驱动表中没有记录可以匹配，该驱动表记录仍会加⼊到结果中，对应的被驱动表字段以 null 填充

### 6.3、嵌套循环连接

如果有3个表进⾏连接，那么表1和表2完成连接后的结果作为驱动表，将表3作为被驱动表进⾏连接查询

减少被驱动表的访问次数

### 6.4、索引

在根据驱动表的⼀条记录去被驱动表中查询时，相当于确定搜索条件的单表查询，可以使⽤索引优化单表查询

在被驱动表上使用二级索引进⾏查询时，可能连接查询的变量和过滤条件都是⼆级索引的部分列，可以不用回表直接覆盖索引，所以最好不要用 * 作为查询列表，而是使⽤真正需要查询的列

# 二、MySQL 锁

## 1、Innodb 使用表锁还是行锁？

大部分情况用行锁

**使用表锁的情况**：

1. 表比较大，事务需要更新全部或者大部分数据
2. 事务涉及到多个表，比较复杂，可能引起死锁，造成大量的事务回滚

## 2、锁的种类

### 2.1、全局锁

对**整个数据库实例**加锁。















